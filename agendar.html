<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>José Barbearia - Agendamento</title>

<style>
body {
    margin:0;
    font-family: Arial, sans-serif;
    background:#0d0d0d;
    color:#fff;
}

.container {
    max-width:400px;
    margin:auto;
    padding:20px;
}

h2 {
    text-align:center;
    color:#c9a227;
}

input, select {
    width:100%;
    padding:12px;
    margin-bottom:10px;
    border-radius:6px;
    border:1px solid #333;
    background:#1a1a1a;
    color:#fff;
}

#horarios {
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:8px;
    margin:10px 0;
}

.horario {
    background:#1a1a1a;
    padding:10px;
    text-align:center;
    border-radius:6px;
    border:1px solid #333;
    cursor:pointer;
}

.horario:hover {
    border-color:#c9a227;
}

.selecionado {
    background:#c9a227;
    color:#000;
    font-weight:bold;
}

button {
    width:100%;
    padding:14px;
    background:#c9a227;
    border:none;
    font-size:16px;
    font-weight:bold;
    border-radius:6px;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="container">
<h2>Agendar Horário</h2>

<input type="text" id="nome" placeholder="Seu nome">
<input type="tel" id="telefone" placeholder="Telefone">

<select id="servico">
<option value="">Escolha o serviço</option>
<option value="50">Corte (50min)</option>
<option value="30">Barba (30min)</option>
<option value="60">Corte + Barba (60min)</option>
<option value="40">Corte Infantil (40min)</option>
</select>

<input type="date" id="data">

<div id="horarios"></div>

<input type="hidden" id="hora">

<button onclick="confirmar()">Confirmar Agendamento</button>
</div>

<script>

window.onload = function(){
    document.getElementById("nome").value = localStorage.getItem("nome") || "";
    document.getElementById("telefone").value = localStorage.getItem("telefone") || "";

    // Bloquear datas passadas
    var hoje = new Date().toISOString().split("T")[0];
    document.getElementById("data").setAttribute("min", hoje);
}

document.getElementById("data").addEventListener("change", gerarHorarios);

function gerarHorarios(){

    var container = document.getElementById("horarios");
    container.innerHTML = "";

    var data = document.getElementById("data").value;
    if(!data) return;

    var hoje = new Date();
    hoje.setHours(0,0,0,0);

    var dataEscolhida = new Date(data);
    dataEscolhida.setHours(0,0,0,0);

    if(dataEscolhida < hoje){
        container.innerHTML = "<p>Não é possível agendar em datas passadas</p>";
        return;
    }

    var diaSemana = new Date(data).getDay();

    if(diaSemana === 0){
        container.innerHTML = "<p>Fechado aos domingos</p>";
        return;
    }

    var periodos = [];

    if(diaSemana === 1 || diaSemana === 4 || diaSemana === 5){
        periodos = [
            {inicio:"09:00", fim:"12:00"},
            {inicio:"13:00", fim:"19:00"}
        ];
    }

    if(diaSemana === 2 || diaSemana === 3){
        periodos = [
            {inicio:"09:00", fim:"12:00"},
            {inicio:"13:00", fim:"18:00"}
        ];
    }

    if(diaSemana === 6){
        periodos = [
            {inicio:"08:30", fim:"20:00"}
        ];
    }

    var agendaDia = JSON.parse(localStorage.getItem("agenda_"+data)) || [];
    var agora = new Date();

    periodos.forEach(function(periodo){

        var [hInicio,mInicio] = periodo.inicio.split(":").map(Number);
        var [hFim,mFim] = periodo.fim.split(":").map(Number);

        var atual = new Date();
        atual.setHours(hInicio,mInicio,0);

        var fim = new Date();
        fim.setHours(hFim,mFim,0);

        while(atual < fim){

            var horaTexto =
                ("0"+atual.getHours()).slice(-2)+":"+
                ("0"+atual.getMinutes()).slice(-2);

            var horaDataCompleta = new Date(data+"T"+horaTexto);

            if(horaDataCompleta > agora && !agendaDia.includes(horaTexto)){

                var div = document.createElement("div");
                div.className = "horario";
                div.innerText = horaTexto;

                div.onclick = function(){
                    document.querySelectorAll(".horario")
                    .forEach(x=>x.classList.remove("selecionado"));
                    this.classList.add("selecionado");
                    document.getElementById("hora").value = this.innerText;
                };

                container.appendChild(div);
            }

            atual.setMinutes(atual.getMinutes()+10);
        }

    });
}

function confirmar(){

    var nome = document.getElementById("nome").value;
    var telefone = document.getElementById("telefone").value;
    var servico = parseInt(document.getElementById("servico").value);
    var servicoTexto = document.getElementById("servico").selectedOptions[0].text;
    var data = document.getElementById("data").value;
    var hora = document.getElementById("hora").value;

    if(!nome || !telefone || !servico || !data || !hora){
        alert("Preencha todos os campos");
        return;
    }

    localStorage.setItem("nome",nome);
    localStorage.setItem("telefone",telefone);

    var agendaDia = JSON.parse(localStorage.getItem("agenda_"+data)) || [];

    var inicio = new Date(data+"T"+hora);

    var total = servico + 10;

    for(var i=0;i<total;i+=10){

        var t = new Date(inicio);
        t.setMinutes(inicio.getMinutes()+i);

        var horaBloqueio =
            ("0"+t.getHours()).slice(-2)+":"+
            ("0"+t.getMinutes()).slice(-2);

        if(!agendaDia.includes(horaBloqueio)){
            agendaDia.push(horaBloqueio);
        }
    }

    localStorage.setItem("agenda_"+data,JSON.stringify(agendaDia));

    var mensagem =
`Olá, ${nome} seu agendamento foi confirmado!

Serviço: ${servicoTexto}
Data: ${data}
Hora: ${hora}

Endereço:
Av. Otávio Rangel, 477 - Guariba - SP`;

    var numero = "5516997369740";
    var url = "https://wa.me/"+numero+"?text="+encodeURIComponent(mensagem);

    window.open(url,"_blank");

    gerarHorarios();
}
</script>

</body>
</html>
