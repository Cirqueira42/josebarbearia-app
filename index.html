<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>José Barbearia</title>

<style>
body{
margin:0;
font-family:Arial;
background:#0d0d0d;
color:#fff;
text-align:center;
}
.container{
max-width:420px;
margin:auto;
padding:20px;
}
h1{color:#00e676;}
input,select,button{
width:100%;
padding:14px;
margin-top:8px;
border-radius:10px;
border:none;
font-size:16px;
}
button{
background:#00c853;
color:#fff;
font-weight:bold;
}
.horarios{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:6px;
margin-top:10px;
}
.horarios button{
background:#1f1f1f;
}
.admin{
background:#1a1a1a;
padding:15px;
margin-top:20px;
border-radius:10px;
}
</style>

</head>
<body>

<div class="container">
<h1>José Barbearia</h1>
<p>Barbeiro: José Gilmario</p>

<input id="nome" placeholder="Seu nome">
<input id="telefone" placeholder="Telefone">

<select id="servico">
<option value="45">Corte - 45min</option>
<option value="30">Barba - 30min</option>
<option value="60">Corte + Barba - 60min</option>
<option value="40">Infantil - 40min</option>
</select>

<input type="date" id="data">

<h3>Horários</h3>
<div class="horarios" id="listaHorarios"></div>

<button onclick="agendar()">Confirmar Agendamento</button>

<div id="status"></div>

<div id="admin" style="display:none" class="admin">
<h3>Área Administrativa</h3>
<input type="date" id="adminData">
<button onclick="verAgendamentos()">Ver Agendamentos</button>
<button onclick="bloquearDia()">Bloquear Dia</button>
<div id="listaAdmin"></div>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>

// ===== COLE SUA CONFIG DO FIREBASE AQUI =====
const firebaseConfig = {
apiKey: "SUA_API_KEY",
authDomain: "SEU_PROJETO.firebaseapp.com",
databaseURL: "https://SEU_PROJETO-default-rtdb.firebaseio.com",
projectId: "SEU_PROJETO",
storageBucket: "SEU_PROJETO.appspot.com",
messagingSenderId: "XXXX",
appId: "XXXX"
};
// ============================================

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const numeroWhats = "5516997369740";
let horarioSelecionado=null;

document.getElementById("data").addEventListener("change",gerarHorarios);

function gerarHorarios(){
let lista=document.getElementById("listaHorarios");
lista.innerHTML="";
let data=document.getElementById("data").value;
if(!data) return;

let agora=new Date();

for(let h=9;h<19;h++){
for(let m=0;m<60;m+=10){

let hora=String(h).padStart(2,"0")+":"+String(m).padStart(2,"0");
let btn=document.createElement("button");
btn.innerText=hora;

let dataHora=new Date(data+"T"+hora);

if(dataHora<agora){
btn.disabled=true;
btn.style.opacity=0.3;
}

db.ref("agendamentos/"+data+"/"+hora).once("value",snap=>{
if(snap.exists()){
btn.disabled=true;
btn.style.opacity=0.3;
}
});

btn.onclick=()=>{
horarioSelecionado=hora;
};

lista.appendChild(btn);
}
}
}

function agendar(){
let nome=document.getElementById("nome").value;
let telefone=document.getElementById("telefone").value;
let servico=parseInt(document.getElementById("servico").value);
let data=document.getElementById("data").value;

if(!nome||!telefone||!data||!horarioSelecionado){
alert("Preencha tudo");
return;
}

let inicio=new Date(data+"T"+horarioSelecionado);

for(let i=0;i<servico;i+=10){
let slot=new Date(inicio.getTime()+i*60000);
let hora=slot.toTimeString().slice(0,5);

db.ref("agendamentos/"+data+"/"+hora).set({
nome:nome,
telefone:telefone
});
}

let codigo=Math.random().toString(36).substring(2,8).toUpperCase();

let mensagem=`Olá, ${nome}!
Seu agendamento foi confirmado.

Serviço: ${servico} minutos
Data: ${data}
Hora: ${horarioSelecionado}
Profissional: José Gilmario
Código: ${codigo}

Para cancelar:
${location.href}?cancelar=${data}_${horarioSelecionado}`;

window.open(`https://wa.me/${numeroWhats}?text=${encodeURIComponent(mensagem)}`);

document.getElementById("status").innerHTML="Agendamento confirmado!";
gerarHorarios();
}

// ===== ADMIN =====
if(location.search.includes("admin=1020")){
document.getElementById("admin").style.display="block";
}

function verAgendamentos(){
let data=document.getElementById("adminData").value;
db.ref("agendamentos/"+data).once("value",snap=>{
let html="";
snap.forEach(s=>{
html+=s.key+" - "+s.val().nome+"<br>";
});
document.getElementById("listaAdmin").innerHTML=html;
});
}

function bloquearDia(){
let data=document.getElementById("adminData").value;
for(let h=9;h<19;h++){
for(let m=0;m<60;m+=10){
let hora=String(h).padStart(2,"0")+":"+String(m).padStart(2,"0");
db.ref("agendamentos/"+data+"/"+hora).set({bloqueado:true});
}
}
alert("Dia bloqueado");
}

</script>

</body>
</html>
