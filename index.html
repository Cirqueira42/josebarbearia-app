
<!DOCTYPE html>

<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Jos√© Barbearia</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg,#0d1b2a,#000814);
  color: white;
  text-align: center;
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 20px;
}

.card {
  background: #1b263b;
  padding: 20px;
  border-radius: 12px;
  margin-top: 15px;
}

input, select, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 8px;
  border: none;
  font-size: 15px;
}

button {
  background: #e63946;
  color: white;
  font-weight: bold;
}

#msg {
  margin-top: 10px;
  font-weight: bold;
}
</style>

</head>
<body>

<div class="container">
  <h1>Jos√© Barbearia</h1>
  <small>Agende seu hor√°rio online</small>

  <div class="card">
    <input type="text" id="nome" placeholder="Seu nome">

```
<select id="servico">
  <option value="">Selecione o servi√ßo</option>
  <option value="Corte (50min)">Corte - R$30 - 50min</option>
  <option value="Barba (30min)">Barba - R$20 - 30min</option>
  <option value="Corte + Barba (60min)">Corte + Barba - R$45 - 60min</option>
  <option value="Corte Infantil (40min)">Corte Infantil - R$25 - 40min</option>
</select>

<input type="date" id="data">

<select id="hora">
  <option value="">Selecione o hor√°rio</option>
</select>

<button onclick="agendar()">Confirmar Agendamento</button>

<p id="msg"></p>
```

  </div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  query,
  where
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// CONFIGURA√á√ÉO DO FIREBASE (j√° ajustada para seu projeto)
const firebaseConfig = {
  apiKey: "AIzaSyD-COLE_AQUI_SUA_API",
  authDomain: "jose-barbearia.firebaseapp.com",
  projectId: "jose-barbearia",
  storageBucket: "jose-barbearia.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abc123"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Salvar nome automaticamente
window.onload = function() {
  const nomeSalvo = localStorage.getItem("clienteNome");
  if (nomeSalvo) {
    document.getElementById("nome").value = nomeSalvo;
  }
};

// Hor√°rios de 10 em 10 minutos
const horariosFixos = [];
for (let h = 9; h <= 18; h++) {
  for (let m = 0; m < 60; m += 10) {
    if (h === 18 && m > 0) break;
    horariosFixos.push(
      String(h).padStart(2,"0") + ":" + String(m).padStart(2,"0")
    );
  }
}

const selectHora = document.getElementById("hora");
const dataInput = document.getElementById("data");

dataInput.addEventListener("change", carregarHorarios);

async function carregarHorarios() {
  const data = dataInput.value;
  selectHora.innerHTML = "<option>Carregando...</option>";

  const q = query(
    collection(db, "agendamentos"),
    where("data", "==", data)
  );

  const snapshot = await getDocs(q);

  let ocupados = [];

  snapshot.forEach(doc => {
    const ag = doc.data();
    const horaInicio = ag.hora;
    const servico = ag.servico;

    let duracao = 0;
    if (servico.includes("60")) duracao = 60;
    else if (servico.includes("50")) duracao = 50;
    else if (servico.includes("40")) duracao = 40;
    else if (servico.includes("30")) duracao = 30;

    let [h, m] = horaInicio.split(":").map(Number);
    let totalMin = h * 60 + m;

    for (let i = 0; i < duracao; i += 10) {
      let min = totalMin + i;
      let hh = Math.floor(min / 60);
      let mm = min % 60;

      ocupados.push(
        String(hh).padStart(2,"0") + ":" +
        String(mm).padStart(2,"0")
      );
    }
  });

  selectHora.innerHTML = "<option value=''>Selecione o hor√°rio</option>";

  horariosFixos.forEach(h => {
    if (!ocupados.includes(h)) {
      let opt = document.createElement("option");
      opt.value = h;
      opt.textContent = h;
      selectHora.appendChild(opt);
    }
  });
}

window.agendar = async function() {
  const nome = document.getElementById("nome").value;
  const servico = document.getElementById("servico").value;
  const data = dataInput.value;
  const hora = selectHora.value;
  const msg = document.getElementById("msg");

  if (!nome || !servico || !data || !hora) {
    msg.innerText = "Preencha todos os campos!";
    return;
  }

  await addDoc(collection(db, "agendamentos"), {
    nome,
    servico,
    data,
    hora,
    criadoEm: new Date()
  });

  localStorage.setItem("clienteNome", nome);

  const codigo = Math.random().toString(36).substring(2,10).toUpperCase();

  const mensagem =
`Ol√°, ${nome} o seu agendamento com a *Jos√© Barbearia* foi confirmado!

*Servi√ßo:* ${servico}
*Quando:* ${data} √†s ${hora}
*Profissional:* JOSE GILMARIO
*C√≥digo:* ${codigo}

üìçEndere√ßo:
Av. Ot√°vio Rangel, 477 - Guariba - SP

üìçMapa:
https://maps.app.goo.gl/JVahTmuAYLfAiyx57`;

  window.open("https://wa.me/5516997369740?text=" + encodeURIComponent(mensagem), "_blank");

  msg.innerText = "Agendado com sucesso!";
  carregarHorarios();
};

</script>

</body>
</html>
