<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>José Barbearia</title>

<style>
body{
margin:0;
font-family:Arial,Helvetica,sans-serif;
background:#0b0b0b;
color:#fff;
}

.topo{
background:#000;
padding:20px;
text-align:center;
border-bottom:2px solid #00c853;
}

.topo h1{
margin:0;
color:#00c853;
font-size:24px;
}

.container{
max-width:420px;
margin:auto;
padding:15px;
}

.card{
background:#141414;
padding:18px;
border-radius:14px;
margin-bottom:18px;
box-shadow:0 4px 15px rgba(0,0,0,0.6);
}

h2{
margin-top:0;
font-size:20px;
}

input,button{
width:100%;
padding:14px;
margin-top:10px;
border-radius:10px;
border:none;
font-size:16px;
}

input{
background:#1f1f1f;
color:#fff;
}

button{
background:#00c853;
color:#fff;
font-weight:bold;
}

.servicos{
display:grid;
grid-template-columns:1fr 1fr;
gap:8px;
margin-top:10px;
}

.servico{
background:#1f1f1f;
padding:10px;
text-align:center;
border-radius:8px;
cursor:pointer;
font-size:14px;
}

.servico.sel{
background:#00c853;
}

.horarios{
display:flex;
flex-wrap:wrap;
gap:6px;
margin-top:12px;
}

.hora{
width:30%;
background:#1f1f1f;
padding:8px;
text-align:center;
border-radius:6px;
cursor:pointer;
}

.hora.sel{
background:#00c853;
}

.hora.ocupado{
background:#700;
pointer-events:none;
}

.admin{
display:none;
}

.footer{
text-align:center;
font-size:12px;
opacity:.6;
margin-top:20px;
}
</style>
</head>
<body>

<div class="topo">
<h1>José Barbearia</h1>
<div>09:00 às 19:00</div>
</div>

<div class="container">

<div class="card">
<h2>Agende seu horário</h2>

<input id="nome" placeholder="Seu nome">

<input type="date" id="data">

<div class="servicos">
<div class="servico" onclick="selServico(this,45,30)">Corte<br>45min</div>
<div class="servico" onclick="selServico(this,30,20)">Barba<br>30min</div>
<div class="servico" onclick="selServico(this,60,45)">Cabelo+Barba<br>60min</div>
<div class="servico" onclick="selServico(this,40,25)">Infantil<br>40min</div>
</div>

<div class="horarios" id="horarios"></div>

<button onclick="agendar()">Confirmar Agendamento</button>

<div id="status"></div>
</div>

<div class="card admin" id="admin">
<h2>Área Administrativa</h2>

<input type="date" id="adminData">
<button onclick="verAgenda()">Ver Agenda</button>
<button onclick="bloquearDia()">Bloquear Dia</button>

<div id="listaAdmin"></div>
</div>

<div class="footer">
Sistema profissional de agendamento
</div>

</div>

<script type="module">

// MOSTRAR ADMIN COM SENHA
const url=new URLSearchParams(location.search);
if(url.get("admin")==="1020"){
document.getElementById("admin").style.display="block";
}

// FIREBASE (COLE SUA CONFIG)
import{initializeApp}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import{getDatabase,ref,push,onValue,set}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig={
apiKey:"COLE",
authDomain:"COLE",
databaseURL:"COLE",
projectId:"COLE",
storageBucket:"COLE",
messagingSenderId:"COLE",
appId:"COLE"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

// SERVIÇO
let duracao=0;
let valor=0;

window.selServico=function(el,dur,val){
document.querySelectorAll(".servico").forEach(s=>s.classList.remove("sel"));
el.classList.add("sel");
duracao=dur;
valor=val;
}

// GERAR HORÁRIOS 10min
const lista=document.getElementById("horarios");
let horaSel=null;

function gerarHorarios(){
lista.innerHTML="";
for(let h=9;h<19;h++){
for(let m=0;m<60;m+=10){
let hora=`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
let div=document.createElement("div");
div.className="hora";
div.textContent=hora;
div.onclick=()=>{
document.querySelectorAll(".hora").forEach(e=>e.classList.remove("sel"));
div.classList.add("sel");
horaSel=hora;
};
lista.appendChild(div);
}}
}

gerarHorarios();

// AGENDAR
window.agendar=function(){
const nome=document.getElementById("nome").value;
const data=document.getElementById("data").value;

if(!nome||!data||!horaSel||!duracao){
alert("Preencha tudo");
return;
}

const codigo=Math.random().toString(36).substring(2,8).toUpperCase();

push(ref(db,"agendamentos/"+data),{
nome,
horario:horaSel,
duracao,
valor,
codigo
}).then(()=>{

const msg=`Olá ${nome}, seu agendamento foi confirmado!

Data: ${data}
Hora: ${horaSel}
Profissional: José Gilmario
Código: ${codigo}

Cancelar:
${location.origin}${location.pathname}?cancelar=${codigo}&data=${data}`;

window.open("https://wa.me/5516997369740?text="+encodeURIComponent(msg));

alert("Agendado com sucesso");
});
};

// ADMIN
window.verAgenda=function(){
const data=document.getElementById("adminData").value;
const lista=document.getElementById("listaAdmin");

onValue(ref(db,"agendamentos/"+data),(snap)=>{
const dados=snap.val();
lista.innerHTML="";
let total=0;

for(let k in dados){
total+=dados[k].valor;
lista.innerHTML+=`
<div style="background:#1f1f1f;padding:8px;margin:6px;border-radius:6px">
${dados[k].horario} - ${dados[k].nome} (R$${dados[k].valor})
<button onclick="cancelarAdmin('${data}','${k}')">Cancelar</button>
</div>`;
}

lista.innerHTML+="<b>Total: R$"+total+"</b>";
});
}

window.cancelarAdmin=function(data,k){
set(ref(db,"agendamentos/"+data+"/"+k),null);
}

window.bloquearDia=function(){
const data=document.getElementById("adminData").value;
set(ref(db,"agendamentos/"+data),{bloqueado:true});
}

</script>
</body>
</html>
